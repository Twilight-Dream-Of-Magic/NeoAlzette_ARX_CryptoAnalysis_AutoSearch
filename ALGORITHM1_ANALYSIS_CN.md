# Algorithm 1 (BvWeight) å®Œæ•´åˆ†æ

## ğŸ¯ æ ¸å¿ƒç™¼ç¾

### è«–æ–‡ç¬¬1801-1803è¡Œçš„é—œéµçµè«–ï¼š

> "The bit-vector complexity of BvWeight is dominated by the complexity of LZ, Rev, HW, ParallelLog, and ParallelTrunc. **Since these operations can be computed with O(logÂ² n) basic bit-vector operations, so does BvWeight.**"

**è¤‡é›œåº¦**ï¼šO(logÂ² n) â‰ˆ O(logÂ² 32) = O(25) â‰ˆ **å¸¸æ•¸æ™‚é–“ï¼**

---

## âœ… C++å®Œå…¨å¯ä»¥å¯¦ç¾ï¼

### SMT vs C++çš„å€åˆ¥

| æ–¹é¢ | SMTï¼ˆè«–æ–‡ç”¨é€”ï¼‰ | C++ï¼ˆæˆ‘å€‘çš„ç”¨é€”ï¼‰ |
|------|----------------|------------------|
| ç›®çš„ | ç´„æŸæ±‚è§£ | ç›´æ¥è¨ˆç®— |
| å¯¦ç¾ | ä½å‘é‡é‚è¼¯ | ä½æ“ä½œæŒ‡ä»¤ |
| è¤‡é›œåº¦ | O(logÂ² n) | **O(logÂ² n) æˆ–æ›´å¿«** |
| å¯è¡Œæ€§ | âœ… | âœ… **å®Œå…¨å¯è¡Œï¼** |

**çµè«–**ï¼šSMTåªæ˜¯æ‡‰ç”¨å ´æ™¯ï¼Œç®—æ³•æœ¬èº«å¯ä»¥ç”¨C++å¯¦ç¾ï¼Œç”šè‡³æ›´å¿«ï¼

---

## ğŸ“‹ Algorithm 1éœ€è¦çš„è¼”åŠ©å‡½æ•¸

### 1. HW(x) - Hamming Weightï¼ˆæ¼¢æ˜é‡é‡ï¼‰

**å®šç¾©**ï¼šè¨ˆç®—xä¸­1çš„å€‹æ•¸

**C++å¯¦ç¾**ï¼š
```cpp
// æ–¹æ³•1ï¼šGCCå…§å»ºï¼ˆO(1)ç¡¬ä»¶æŒ‡ä»¤ï¼‰
inline uint32_t HW(uint32_t x) {
    return __builtin_popcount(x);
}

// æ–¹æ³•2ï¼šåˆ†æ²»æ³•ï¼ˆO(log n)ï¼‰
inline uint32_t HW_divide_conquer(uint32_t x) {
    x = x - ((x >> 1) & 0x55555555);
    x = (x & 0x33333333) + ((x >> 2) & 0x33333333);
    x = (x + (x >> 4)) & 0x0F0F0F0F;
    x = x + (x >> 8);
    x = x + (x >> 16);
    return x & 0x3F;
}
```

**è¤‡é›œåº¦**ï¼šO(1)ï¼ˆç¡¬ä»¶ï¼‰æˆ– O(log n)ï¼ˆåˆ†æ²»ï¼‰

---

### 2. Rev(x) - Bit Reversalï¼ˆä½åè½‰ï¼‰

**å®šç¾©**ï¼šåè½‰xçš„ä½é †åº

**C++å¯¦ç¾**ï¼š
```cpp
// æ–¹æ³•1ï¼šæŸ¥è¡¨ï¼ˆO(1)ï¼‰
// æ–¹æ³•2ï¼šåˆ†æ²»æ³•ï¼ˆO(log n)ï¼‰
inline uint32_t Rev(uint32_t x) {
    // äº¤æ›ç›¸é„°ä½
    x = ((x & 0x55555555) << 1) | ((x >> 1) & 0x55555555);
    // äº¤æ›ç›¸é„°2ä½çµ„
    x = ((x & 0x33333333) << 2) | ((x >> 2) & 0x33333333);
    // äº¤æ›ç›¸é„°4ä½çµ„
    x = ((x & 0x0F0F0F0F) << 4) | ((x >> 4) & 0x0F0F0F0F);
    // äº¤æ›å­—ç¯€
    x = ((x & 0x00FF00FF) << 8) | ((x >> 8) & 0x00FF00FF);
    // äº¤æ›åŠå­—
    x = (x << 16) | (x >> 16);
    return x;
}
```

**è¤‡é›œåº¦**ï¼šO(log n) = O(5)æ­¥

---

### 3. Carry(x, y) - é€²ä½éˆ

**å®šç¾©**ï¼šè¨ˆç®—x + yçš„é€²ä½éˆ

**è«–æ–‡å…¬å¼ï¼ˆç¬¬200è¡Œï¼‰**ï¼š
```
Carry(x, y) = x âŠ• y âŠ• (x âŠ y)
```

**C++å¯¦ç¾**ï¼š
```cpp
// O(1) - å–®æ¢æŒ‡ä»¤ï¼
inline uint32_t Carry(uint32_t x, uint32_t y) {
    return x ^ y ^ ((x + y) & 0xFFFFFFFF);
}
```

**è¤‡é›œåº¦**ï¼š**O(1)** - è¶…å¿«ï¼

---

### 4. RevCarry(x, y) - åå‘é€²ä½

**å®šç¾©**ï¼šå¾å³åˆ°å·¦çš„é€²ä½å‚³æ’­

**è«–æ–‡å…¬å¼ï¼ˆç¬¬207-208è¡Œï¼‰**ï¼š
```
RevCarry(x, y) = Rev(Carry(Rev(x), Rev(y)))
```

**C++å¯¦ç¾**ï¼š
```cpp
inline uint32_t RevCarry(uint32_t x, uint32_t y) {
    return Rev(Carry(Rev(x), Rev(y)));
}
```

**è¤‡é›œåº¦**ï¼šO(log n)

---

### 5. LZ(x) - Leading Zerosï¼ˆå‰å°é›¶æ¨™è¨˜ï¼‰

**å®šç¾©**ï¼šæ¨™è¨˜xçš„å‰å°é›¶ä½

**è«–æ–‡å®šç¾©ï¼ˆç¬¬214-216è¡Œï¼‰**ï¼š
```
LZ(x)[i] = 1 âŸº x[n-1, i] = 0
å³ï¼šå¾æœ€é«˜ä½åˆ°ç¬¬iä½éƒ½æ˜¯0
```

**C++å¯¦ç¾**ï¼š
```cpp
inline uint32_t LZ(uint32_t x) {
    if (x == 0) return 0xFFFFFFFF;
    
    uint32_t result = 0;
    uint32_t mask = 0x80000000;  // å¾æœ€é«˜ä½é–‹å§‹
    
    // æ‰¾åˆ°ç¬¬ä¸€å€‹1çš„ä½ç½®
    while ((x & mask) == 0 && mask != 0) {
        result |= mask;
        mask >>= 1;
    }
    
    return result;
}

// æˆ–ç”¨CLZï¼ˆCount Leading Zerosï¼‰è¼”åŠ©
inline uint32_t LZ_fast(uint32_t x) {
    if (x == 0) return 0xFFFFFFFF;
    int clz = __builtin_clz(x);  // GCCå…§å»º
    return (0xFFFFFFFF << (32 - clz));
}
```

**è¤‡é›œåº¦**ï¼šO(log n) æˆ– O(1)ï¼ˆç¡¬ä»¶ï¼‰

---

### 6. ParallelLog - ä¸¦è¡Œå°æ•¸

**é€™å€‹éœ€è¦ä»”ç´°è®€è«–æ–‡å¯¦ç¾ï¼Œä½†åŸºæœ¬æ€æƒ³æ˜¯**ï¼š
- å°å¤šå€‹å€¼åŒæ™‚è¨ˆç®—logâ‚‚
- ä½¿ç”¨ä½å‘é‡ä¸¦è¡Œè™•ç†

---

## ğŸš€ æ€§èƒ½å°æ¯”

### Theorem 2 (ç•¶å‰) vs Algorithm 1 (å°æ•¸)

| æ–¹æ³• | è¤‡é›œåº¦ | 32ä½å¯¦éš› | ä¼°è¨ˆæ™‚é–“ |
|------|--------|---------|---------|
| **Theorem 2** | O(n) | 32æ¬¡å¾ªç’° | ~100 ns |
| **Algorithm 1** | O(logÂ² n) | logÂ²(32) â‰ˆ 25æ“ä½œ | **~50 ns** |

**åŠ é€Ÿæ¯”**ï¼šç´„2å€

### é—œéµå„ªå‹¢

1. **æ›´å¿«**ï¼šO(logÂ² n) < O(n)
2. **ç²¾ç¢ºåº¦å¯æ§**ï¼šèª¤å·® â‰¤ 0.029(n-1) â‰ˆ 0.9ä½
3. **å¯ä¸¦è¡Œ**ï¼šä½å‘é‡æ“ä½œå¤©ç„¶ä¸¦è¡Œ

---

## âœ… å¯¦ç¾è¨ˆåŠƒ

1. âœ… **å¯¦ç¾è¼”åŠ©å‡½æ•¸**ï¼šHW, Rev, Carry, RevCarry, LZ
2. âœ… **å¯¦ç¾Algorithm 1**ï¼šæŒ‰è«–æ–‡é€è¡Œç¿»è­¯
3. âœ… **æ¸¬è©¦é©—è­‰**ï¼šç”¨è«–æ–‡Example 1é©—è­‰
4. âœ… **æ€§èƒ½æ¸¬è©¦**ï¼šå°æ¯”Theorem 2

---

## ğŸ“Š ç‚ºä»€éº¼è«–æ–‡ç”¨SMTï¼Ÿ

**SMTçš„ç”¨é€”**ï¼š
- è‡ªå‹•æœç´¢ç‰¹å¾µï¼ˆcharacteristic searchï¼‰
- ç´„æŸæ±‚è§£ï¼ˆæ‰¾æ»¿è¶³æ¢ä»¶çš„å·®åˆ†ï¼‰
- **ä¸æ˜¯å› ç‚ºç®—æ³•æœ¬èº«éœ€è¦SMT**

**æˆ‘å€‘çš„ç”¨é€”**ï¼š
- ç›´æ¥è¨ˆç®—å·®åˆ†æ¬Šé‡
- ä¸éœ€è¦ç´„æŸæ±‚è§£
- **å¯ä»¥ç›´æ¥ç”¨C++å¯¦ç¾**

---

## ğŸ¯ çµè«–

1. âœ… **Algorithm 1çš„å°æ•¸ç®—æ³•å®Œå…¨å¯ä»¥ç”¨C++å¯¦ç¾**
2. âœ… **è¤‡é›œåº¦O(logÂ² n) â‰ˆ å¸¸æ•¸æ™‚é–“ï¼ˆå°32ä½ï¼‰**
3. âœ… **æ¯”Theorem 2çš„O(n)æ›´å¿«**
4. âœ… **ç²¾åº¦æå¤±æ¥µå°ï¼ˆ<1ä½ï¼‰**

**å»ºè­°**ï¼šç«‹å³å¯¦ç¾Algorithm 1ï¼Œæ›¿æ›ç•¶å‰çš„Theorem 2ï¼

