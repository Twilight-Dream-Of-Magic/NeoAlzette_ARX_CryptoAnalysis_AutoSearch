cmake_minimum_required(VERSION 3.14)
project(NeoAlzette_ARX_CryptoAnalysis VERSION 1.0.0 LANGUAGES CXX)

# C++20æ¨™æº–
set(CMAKE_CXX_STANDARD 20)
set(CMAKE_CXX_STANDARD_REQUIRED ON)
set(CMAKE_CXX_EXTENSIONS OFF)

# ç·¨è­¯é¸é …
set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -Wall -Wextra -O3 -march=native")
set(CMAKE_CXX_FLAGS_DEBUG "${CMAKE_CXX_FLAGS_DEBUG} -g -O0")
set(CMAKE_CXX_FLAGS_RELEASE "${CMAKE_CXX_FLAGS_RELEASE} -O3 -DNDEBUG")

# åŒ…å«ç›®éŒ„
include_directories(${CMAKE_SOURCE_DIR}/include)

# ============================================================================
# åº•å±¤ARXåˆ†æç®—å­ï¼ˆHeader-onlyï¼‰
# ============================================================================
# arx_analysis_operators/ æ–‡ä»¶å¤¾ä¸‹çš„æ‰€æœ‰ç®—å­éƒ½æ˜¯header-only
# ç„¡éœ€ç·¨è­¯ï¼Œç›´æ¥includeå³å¯ä½¿ç”¨

# ============================================================================
# NeoAlzetteæ ¸å¿ƒåº«
# ============================================================================
set(NEOALZETTE_SOURCES
    src/neoalzette/neoalzette_core.cpp
    src/neoalzette/neoalzette_differential.cpp
    src/neoalzette/neoalzette_linear.cpp
    src/neoalzette/neoalzette_medcp.cpp
    src/neoalzette/neoalzette_melcc.cpp
)

add_library(neoalzette STATIC ${NEOALZETTE_SOURCES})
target_include_directories(neoalzette PUBLIC ${CMAKE_SOURCE_DIR}/include)

# ============================================================================
# ARXæœç´¢æ¡†æ¶åº«
# ============================================================================
set(ARX_FRAMEWORK_SOURCES
    src/arx_search_framework/pddt_algorithm1_complete.cpp
    src/arx_search_framework/matsui_algorithm2_complete.cpp
    src/arx_search_framework/medcp_analyzer.cpp
    src/arx_search_framework/melcc_analyzer.cpp
    src/arx_search_framework/threshold_search_framework.cpp
    src/utility_tools.cpp
)

add_library(arx_framework STATIC ${ARX_FRAMEWORK_SOURCES})
target_include_directories(arx_framework PUBLIC ${CMAKE_SOURCE_DIR}/include)
target_link_libraries(arx_framework PUBLIC neoalzette)

# ============================================================================
# å·¥å…·ç¨‹åº
# ============================================================================

# Highwayè¡¨æ§‹å»ºå·¥å…·ï¼ˆå·®åˆ†ï¼‰
add_executable(highway_table_build src/highway_table_build.cpp)
target_link_libraries(highway_table_build PRIVATE arx_framework neoalzette)

# Highwayè¡¨æ§‹å»ºå·¥å…·ï¼ˆç·šæ€§ï¼‰
add_executable(highway_table_build_lin src/highway_table_build_lin.cpp)
target_link_libraries(highway_table_build_lin PRIVATE arx_framework neoalzette)

# ============================================================================
# å®‰è£é…ç½®
# ============================================================================
install(TARGETS neoalzette arx_framework
        ARCHIVE DESTINATION lib
        LIBRARY DESTINATION lib)

install(DIRECTORY include/
        DESTINATION include
        FILES_MATCHING
        PATTERN "*.hpp"
        PATTERN "*.h")

# ============================================================================
# æ¸¬è©¦ï¼ˆå¯é¸ï¼‰
# ============================================================================
option(BUILD_TESTS "Build test programs" OFF)
if(BUILD_TESTS)
    enable_testing()
    # æ·»åŠ æ¸¬è©¦ç¨‹åº
endif()

# ============================================================================
# æ–‡æª”
# ============================================================================
message(STATUS "")
message(STATUS "=======================================================")
message(STATUS "NeoAlzette ARXå¯†ç¢¼åˆ†æèˆ‡è‡ªå‹•åŒ–æœç´¢")
message(STATUS "=======================================================")
message(STATUS "")
message(STATUS "ğŸ“ é …ç›®çµæ§‹ï¼š")
message(STATUS "  include/arx_analysis_operators/  - åº•å±¤ARXç®—å­ï¼ˆæœ€å„ªåŒ–ï¼‰")
message(STATUS "  include/arx_search_framework/    - è‡ªå‹•åŒ–æœç´¢æ¡†æ¶")
message(STATUS "  include/neoalzette/              - NeoAlzetteå°ˆç”¨")
message(STATUS "")
message(STATUS "ğŸ“š åº•å±¤ç®—å­ï¼š")
message(STATUS "  â€¢ differential_xdp_add.hpp       - LM-2001 (O(1))")
message(STATUS "  â€¢ differential_addconst.hpp      - BvWeight (O(logÂ²n))")
message(STATUS "  â€¢ linear_cor_add.hpp             - WallÃ©n M_n^T (O(n))")
message(STATUS "  â€¢ linear_cor_addconst.hpp        - WallÃ©n DP (O(n))")
message(STATUS "")
message(STATUS "ğŸ” æœç´¢æ¡†æ¶ï¼š")
message(STATUS "  â€¢ pddt/                          - pDDTæ§‹å»º")
message(STATUS "  â€¢ clat/                          - cLATæ§‹å»ºï¼ˆAlgorithm 1/2/3ï¼‰")
message(STATUS "  â€¢ matsui/                        - Matsuié–¾å€¼æœç´¢")
message(STATUS "  â€¢ medcp_analyzer.hpp             - MEDCPåˆ†æ")
message(STATUS "  â€¢ melcc_analyzer.hpp             - MELCCåˆ†æ")
message(STATUS "")
message(STATUS "ğŸ¯ æ§‹å»ºç›®æ¨™ï¼š")
message(STATUS "  â€¢ libneoalzette.a                - NeoAlzetteåº«")
message(STATUS "  â€¢ libarx_framework.a             - æœç´¢æ¡†æ¶åº«")
message(STATUS "  â€¢ highway_table_build            - Highwayè¡¨å·¥å…·ï¼ˆå·®åˆ†ï¼‰")
message(STATUS "  â€¢ highway_table_build_lin        - Highwayè¡¨å·¥å…·ï¼ˆç·šæ€§ï¼‰")
message(STATUS "")
message(STATUS "=======================================================")
message(STATUS "")
