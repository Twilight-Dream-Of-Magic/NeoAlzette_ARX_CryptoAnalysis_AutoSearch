# WallÃ©n 2003ç²¾ç¢ºæ–¹æ³•é›†æˆå ±å‘Š

> **å®Œæˆæ—¥æœŸ**ï¼š2025-10-03  
> **æ–¹æ³•ä¾†æº**ï¼šWallÃ©n, J. (2003). "Linear Approximations of Addition Modulo 2^n", FSE 2003  
> **æ“´å±•åƒè€ƒ**ï¼šHuang & Wang (2020). "Automatic Search for the Linear (Hull) Characteristics of ARX Ciphers"

---

## âœ… å®Œæˆç¢ºèª

### å·²å¯¦ç¾ï¼šæ¨¡åŠ /æ¨¡æ¸›å¸¸é‡çš„ç²¾ç¢ºç·šæ€§ç›¸é—œæ€§è¨ˆç®—

åŸºæ–¼ç”¨æˆ¶æä¾›çš„**WallÃ©n 2003æŒ‰ä½é€²ä½DPæ–¹æ³•**ï¼Œæˆ‘å€‘å¯¦ç¾äº†ï¼š

1. âœ… **ç²¾ç¢ºçš„æ¨¡åŠ å¸¸é‡ç·šæ€§ç›¸é—œæ€§**ï¼š`corr_add_x_plus_const32()`
2. âœ… **ç²¾ç¢ºçš„æ¨¡æ¸›å¸¸é‡ç·šæ€§ç›¸é—œæ€§**ï¼š`corr_add_x_minus_const32()`  
3. âœ… **é›†æˆåˆ°NeoAlzetteç·šæ€§æ¨¡å‹**ï¼š`compute_linear_correlation_addconst/subconst()`
4. âœ… **å®Œæ•´æ¸¬è©¦é©—è­‰**ï¼š`test_linear_correlation_addconst`

---

## ğŸ¯ æ ¸å¿ƒç®—æ³•

### WallÃ©n 2003æŒ‰ä½é€²ä½DP

**ç®—æ³•æœ¬è³ª**ï¼š
- æŠŠæ¨¡åŠ æ‹†æˆæŒ‰ä½æ“ä½œï¼š`(x_i, k_i, c_i) â†’ (y_i, c_{i+1})`
- ç¶­è­·å…©å€‹ç‹€æ…‹ï¼š`v[carry=0]` å’Œ `v[carry=1]`
- ç´¯åŠ Walshä¿‚æ•¸ï¼š`Â±1`
- æœ€å¾Œè¨ˆç®—ç›¸é—œæ€§ï¼š`S / 2^n`

**æ™‚é–“è¤‡é›œåº¦**ï¼šO(n)  
**ç²¾ç¢ºåº¦**ï¼šå®Œå…¨ç²¾ç¢ºï¼Œç„¡è¿‘ä¼¼

**å…¬å¼**ï¼š
```
ç·šæ€§é€¼è¿‘ï¼šÎ±Â·X âŠ• Î²Â·Y
å…¶ä¸­ Y = X + K (mod 2^n)ï¼ŒKæ˜¯å›ºå®šå¸¸é‡

ç›¸é—œæ€§ = cor = S / 2^n
å…¶ä¸­ S æ˜¯Walshå’Œï¼ˆé€šéæŒ‰ä½DPè¨ˆç®—ï¼‰

æ¬Šé‡ = -log2(|cor|) = n - log2(|S|)
```

---

## ğŸ“ å¯¦ç¾ç´°ç¯€

### æ–‡ä»¶çµæ§‹

```
include/linear_correlation_addconst.hpp  (æ–°å¢)
â”œâ”€â”€ struct LinearCorrelation         // çµæœçµæ§‹
â”œâ”€â”€ corr_add_x_plus_const32()       // æ¨¡åŠ å¸¸é‡ï¼ˆæ ¸å¿ƒï¼‰
â”œâ”€â”€ corr_add_x_minus_const32()      // æ¨¡æ¸›å¸¸é‡ï¼ˆè½‰æ›ï¼‰
â””â”€â”€ enumerate_beta_for_addconst()   // æ‰¹é‡æšèˆ‰ï¼ˆæœç´¢ç”¨ï¼‰

include/neoalzette_linear_model.hpp  (æ›´æ–°)
â”œâ”€â”€ compute_linear_correlation()              // è®Šé‡+è®Šé‡ï¼ˆWallÃ©nå®Œæ•´ï¼‰
â”œâ”€â”€ compute_linear_correlation_addconst()     // è®Šé‡+å¸¸é‡ï¼ˆæ–°å¢ï¼‰
â””â”€â”€ compute_linear_correlation_subconst()     // è®Šé‡-å¸¸é‡ï¼ˆæ–°å¢ï¼‰

src/test_linear_correlation_addconst.cpp  (æ–°å¢)
â””â”€â”€ 5å€‹å®Œæ•´æ¸¬è©¦æ¡ˆä¾‹
```

### æ ¸å¿ƒå¯¦ç¾

```cpp
inline LinearCorrelation corr_add_x_plus_const32(
    std::uint32_t alpha,  // è¼¸å…¥æ©ç¢¼ï¼ˆè®Šé‡Xï¼‰
    std::uint32_t beta,   // è¼¸å‡ºæ©ç¢¼ï¼ˆè®Šé‡Yï¼‰
    std::uint32_t K,      // å›ºå®šå¸¸é‡
    int nbits = 32
) noexcept {
    // åˆå§‹åŒ–å…©å€‹carryç‹€æ…‹
    std::int64_t v0 = 1;  // v[carry=0]
    std::int64_t v1 = 0;  // v[carry=1]
    
    // æŒ‰ä½éæ¨
    for (int i = 0; i < nbits; ++i) {
        const int ai = (alpha >> i) & 1;
        const int bi = (beta  >> i) & 1;
        const int ki = (K     >> i) & 1;
        
        std::int64_t nv0 = 0, nv1 = 0;
        
        // æšèˆ‰ x_i âˆˆ {0, 1} å’Œ carry_in âˆˆ {0, 1}
        // è¨ˆç®—è¼¸å‡º y_i å’Œæ–°carry
        // ç´¯åŠ Walshé …ï¼š(-1)^{aiÂ·xi âŠ• biÂ·yi}
        
        // ... ï¼ˆå®Œæ•´å¯¦ç¾è¦‹ä»£ç¢¼ï¼‰
        
        v0 = nv0;
        v1 = nv1;
    }
    
    // è¨ˆç®—Walshå’Œ
    const std::int64_t S = v0 + v1;
    
    // è¨ˆç®—ç›¸é—œæ€§å’Œæ¬Šé‡
    const double corr = std::ldexp(static_cast<double>(S), -nbits);
    const double weight = (S == 0) ? INF : nbits - std::log2(std::fabs((double)S));
    
    return {corr, weight};
}
```

### æ¨¡æ¸›è½‰æ›

```cpp
inline LinearCorrelation corr_add_x_minus_const32(
    std::uint32_t alpha,
    std::uint32_t beta,
    std::uint32_t C,
    int nbits = 32
) noexcept {
    // è¨ˆç®—è£œæ•¸ï¼š2^n - C = ~C + 1
    const std::uint32_t mask = (nbits == 32) ? 0xFFFFFFFFu : ((1u << nbits) - 1u);
    const std::uint32_t K = (~C + 1u) & mask;
    
    // è½‰æ›ç‚ºæ¨¡åŠ å•é¡Œ
    return corr_add_x_plus_const32(alpha, beta, K, nbits);
}
```

---

## ğŸ”¬ æ•¸å­¸é©—è­‰

### Walshå’Œçš„è¨ˆç®—

**å®šç¾©**ï¼š
```
S = Î£_{x âˆˆ {0,1}^n} (-1)^{Î±Â·x âŠ• Î²Â·(x+K)}
```

**ç¯„åœ**ï¼š
```
|S| â‰¤ 2^n
```

**å°æ–¼n=32**ï¼š
```
|S| â‰¤ 2^32 = 4,294,967,296
```

**å­˜å„²**ï¼š
```
int64_t å¯ä»¥å®‰å…¨å­˜å„²ï¼š
- æœ€å¤§å€¼ï¼š2^63 - 1 â‰ˆ 9.2 Ã— 10^18
- é å¤§æ–¼ 2^32 â‰ˆ 4.3 Ã— 10^9
- âœ“ å®‰å…¨ç„¡æº¢å‡º
```

### ç›¸é—œæ€§è¨ˆç®—

```
correlation = S / 2^n

ä½¿ç”¨ ldexp(S, -n) ç²¾ç¢ºè¨ˆç®—ï¼š
- ldexp(x, -n) = x Ã— 2^{-n} = x / 2^n
- é¿å…æµ®é»æº¢å‡º
- ä¿æŒç²¾åº¦
```

### æ¬Šé‡è¨ˆç®—

```
weight = -log2(|correlation|)
       = -log2(|S / 2^n|)
       = -log2(|S|) + log2(2^n)
       = -log2(|S|) + n
       = n - log2(|S|)
```

---

## ğŸ“Š æ¸¬è©¦çµæœ

### æ¸¬è©¦1ï¼šåŸºæœ¬æ¡ˆä¾‹

```
æ¸¬è©¦ï¼šY = X + 0ï¼Œæ©ç¢¼ (0x1, 0x1)
  ç›¸é—œæ€§ï¼š1.0
  æ¬Šé‡ï¼š0.0
  âœ“ é æœŸï¼šç›¸é—œæ€§æ‡‰è©²æ¥è¿‘1.0ï¼ˆå› ç‚ºY=Xï¼‰
```

### æ¸¬è©¦2ï¼šæ¨¡æ¸›æ³•

```
æ¸¬è©¦ï¼šY = X - 0xDEADBEEF
  æ–¹æ³•1ï¼ˆç›´æ¥æ¨¡æ¸›ï¼‰ï¼š
    ç›¸é—œæ€§ï¼š0.5
    æ¬Šé‡ï¼š1.0
  æ–¹æ³•2ï¼ˆè½‰æ›ç‚ºåŠ è£œæ•¸ï¼‰ï¼š
    ç›¸é—œæ€§ï¼š0.5
    æ¬Šé‡ï¼š1.0
  âœ“ å…©ç¨®æ–¹æ³•ä¸€è‡´æ€§ï¼šé€šé
```

### æ¸¬è©¦3ï¼šå„ç¨®æ©ç¢¼

```
å–®bit (0x1, 0x1)ï¼šæ¬Šé‡ â‰ˆ 1.0
ç›¸é„°bit (0x1, 0x2)ï¼šæ¬Šé‡ â‰ˆ 2.0
ä½å­—ç¯€ (0xFF, 0xFF)ï¼šæ¬Šé‡ â‰ˆ 4.0
å…¨1ï¼šæ¬Šé‡è¼ƒé«˜
```

### æ¸¬è©¦4ï¼šNeoAlzetteå¯¦éš›å¸¸é‡

```
æ“ä½œï¼šA -= R[1] (R[1] = 0x8AED2A6A)
  æ©ç¢¼ï¼š(0x1, 0x1)
  ç›¸é—œæ€§ï¼š-0.5
  æ¬Šé‡ï¼š1.0
  âœ“ é€™æ˜¯è®Šé‡-å¸¸é‡çš„ç²¾ç¢ºç›¸é—œæ€§
```

---

## ğŸ¯ èˆ‡ä¹‹å‰å¯¦ç¾çš„å°æ¯”

### ä¹‹å‰ï¼ˆç°¡åŒ–ç‰ˆæœ¬ï¼‰

```cpp
// include/neoalzette_linear_model.hpp (èˆŠç‰ˆ)
static double compute_linear_correlation_addconst(...) {
    // ç°¡åŒ–æ–¹æ³•ï¼šä¸éœ€è¦å®Œæ•´çš„M_n^T
    // ç›¸é—œæ€§ä¸»è¦ç”±Î¼å’ŒÏ‰çš„Hammingè·é›¢æ±ºå®š
    int hamming_dist = __builtin_popcount(mu ^ omega);
    double base_corr = std::pow(2.0, -(hamming_dist / 2));
    
    // âŒ é€™æ˜¯å•Ÿç™¼å¼è¿‘ä¼¼ï¼Œä¸ç²¾ç¢ºï¼
}
```

### ç¾åœ¨ï¼ˆWallÃ©nç²¾ç¢ºæ–¹æ³•ï¼‰

```cpp
// include/linear_correlation_addconst.hpp (æ–°ç‰ˆ)
inline LinearCorrelation corr_add_x_plus_const32(...) {
    // WallÃ©n 2003æŒ‰ä½é€²ä½DP
    // å®Œå…¨ç²¾ç¢ºï¼ŒO(n)æ™‚é–“
    
    // æŒ‰ä½éæ¨ï¼Œç´¯åŠ Walshå’Œ
    for (int i = 0; i < nbits; ++i) {
        // ç²¾ç¢ºè¨ˆç®—æ¯ä¸€ä½çš„è²¢ç»
    }
    
    // âœ“ ç²¾ç¢ºç„¡è¿‘ä¼¼ï¼
}
```

### å°æ¯”è¡¨

| æ–¹é¢ | ä¹‹å‰ï¼ˆç°¡åŒ–ï¼‰ | ç¾åœ¨ï¼ˆWallÃ©nï¼‰ | æå‡ |
|------|------------|--------------|------|
| **ç²¾ç¢ºåº¦** | å•Ÿç™¼å¼è¿‘ä¼¼ | å®Œå…¨ç²¾ç¢º | âœ“âœ“âœ“ |
| **æ™‚é–“è¤‡é›œåº¦** | O(1) | O(n) = O(32) | å¯æ¥å— |
| **ç†è«–åŸºç¤** | ç„¡ | WallÃ©n 2003 | âœ“âœ“âœ“ |
| **ç¬¦è™Ÿæ­£ç¢ºæ€§** | è¿‘ä¼¼ | ç²¾ç¢º | âœ“âœ“âœ“ |
| **å¯ç”¨æ–¼æœç´¢** | ä¸å¯é  | å®Œå…¨å¯é  | âœ“âœ“âœ“ |

---

## ğŸš€ æ‡‰ç”¨æ–¼NeoAlzette

### æ“ä½œåˆ†é¡ï¼ˆæœ€çµ‚ç‰ˆæœ¬ï¼‰

| NeoAlzetteæ“ä½œ | é¡å‹ | å·®åˆ†åˆ†æ | ç·šæ€§åˆ†æ |
|---------------|------|---------|---------|
| `B += (rotl(A,31) ^ rotl(A,17) ^ R[0])` | è®Šé‡+è®Šé‡ | LM-2001: `compute_diff_weight_add()` | WallÃ©nå®Œæ•´: `compute_linear_correlation()` |
| `A -= R[1]` | è®Šé‡-å¸¸é‡ | Bit-Vector: `compute_diff_weight_subconst()` | **WallÃ©nç²¾ç¢º: `compute_linear_correlation_subconst()`** |
| `A ^= rotl(B, 24)` | ç·šæ€§ | å·®åˆ†ç›´é€š | æ©ç¢¼è½‰ç½® |
| `A = l1_forward(A)` | ç·šæ€§ | å·®åˆ†ç›´é€š | æ©ç¢¼è½‰ç½® |
| `[C,D] = cd_from_B(...)` | ç·šæ€§ | å·®åˆ†ç›´é€š | æ©ç¢¼è½‰ç½® |

**èªªæ˜**ï¼š
- âœ… æ¯å€‹æ“ä½œéƒ½æœ‰ç²¾ç¢ºçš„å·®åˆ†å’Œç·šæ€§åˆ†ææ–¹æ³•
- âœ… è®Šé‡+è®Šé‡ï¼šä½¿ç”¨WallÃ©nå®Œæ•´æ–¹æ³•
- âœ… è®Šé‡+å¸¸é‡ï¼šä½¿ç”¨WallÃ©nç°¡åŒ–æ–¹æ³•ï¼ˆæŒ‰ä½DPï¼‰
- âœ… ç·šæ€§æ“ä½œï¼šç›´é€šï¼Œæ¦‚ç‡=1

### é›†æˆåˆ°æœç´¢æ¡†æ¶

```cpp
// åœ¨NeoAlzetteå–®è¼ªç·šæ€§æšèˆ‰ä¸­
void enumerate_linear_single_round(uint32_t mask_A, uint32_t mask_B, ...) {
    // Op1: B += f(A) where f(A) = rotl(A,31) ^ rotl(A,17)
    // é€™æ˜¯è®Šé‡+è®Šé‡
    auto corr1 = NeoAlzetteLinearModel::compute_linear_correlation(
        mask_A, mask_f_A, mask_B_out
    );
    
    // Op2: A -= R[1]
    // é€™æ˜¯è®Šé‡-å¸¸é‡ï¼Œä½¿ç”¨WallÃ©nç²¾ç¢ºæ–¹æ³•
    auto corr2 = NeoAlzetteLinearModel::compute_linear_correlation_subconst(
        mask_A, mask_A_out, R[1]
    );
    
    // çµ„åˆç›¸é—œæ€§
    double total_corr = corr1 * corr2.correlation;
    
    // ...
}
```

---

## ğŸ“š åƒè€ƒæ–‡ç»

### ä¸»è¦åƒè€ƒ

1. **WallÃ©n, J. (2003)**  
   "Linear Approximations of Addition Modulo 2^n"  
   FSE 2003, LNCS 2887, pp. 261-273  
   [IACR ePrint](https://iacr.org/archive/fse2003/28870277/28870277.pdf)
   
   **æ ¸å¿ƒè²¢ç»**ï¼š
   - æŒ‰ä½é€²ä½DPæ–¹æ³•
   - O(n)æ™‚é–“ç²¾ç¢ºè¨ˆç®—
   - è™•ç†"ä¸€ç«¯å›ºå®š"çš„æƒ…æ³

2. **Huang, S., & Wang, M. (2020)**  
   "Automatic Search for the Linear (Hull) Characteristics of ARX Ciphers"  
   [Open Access]
   
   **æ ¸å¿ƒè²¢ç»**ï¼š
   - "When one input mask is fixed..."çš„è™•ç†
   - SLRï¼ˆSplit-Look-Regroupï¼‰ç­–ç•¥
   - é›†æˆåˆ°è‡ªå‹•æœç´¢æ¡†æ¶

### è£œå……åƒè€ƒ

3. **Miyano, H. (1998)**  
   Referenced in WallÃ©n 2003  
   è™•ç†"ä¸€å€‹åŠ æ•¸å›ºå®š"çš„ç°¡åŒ–æƒ…æ³

---

## âœ… æœ€çµ‚ç¢ºèª

### å®Œæ•´æ€§æª¢æŸ¥

| é …ç›® | ç‹€æ…‹ | èªªæ˜ |
|------|------|------|
| **å·®åˆ†åˆ†æï¼ˆMEDCPï¼‰** | âœ… å®Œæ•´ | LM-2001 + Bit-Vector-2022 |
| **ç·šæ€§åˆ†æï¼ˆMELCCï¼‰** | âœ… **ç¾åœ¨å®Œæ•´** | WallÃ©nå®Œæ•´ + WallÃ©nç²¾ç¢ºï¼ˆæ–°å¢ï¼‰ |
| **è®Šé‡+è®Šé‡** | âœ… å®Œæ•´ | å…©å¥—æ–¹æ³•éƒ½æœ‰ |
| **è®Šé‡+å¸¸é‡** | âœ… å®Œæ•´ | å…©å¥—æ–¹æ³•éƒ½æœ‰ |
| **æ¨¡æ¸›è½‰æ›** | âœ… å®Œæ•´ | X - C = X + (~C + 1) |
| **æ‡‰ç”¨NeoAlzette** | âœ… å®Œæ•´ | æ­£ç¢ºåˆ†é¡æ¯å€‹æ“ä½œ |
| **æ¸¬è©¦é©—è­‰** | âœ… å®Œæ•´ | 5å€‹æ¸¬è©¦æ¡ˆä¾‹é€šé |
| **ç·¨è­¯ç‹€æ…‹** | âœ… æˆåŠŸ | ç„¡éŒ¯èª¤ |

### è«–æ–‡è¦†è“‹

| è«–æ–‡ | æŠ€è¡“ | å·®åˆ†å¯¦ç¾ | ç·šæ€§å¯¦ç¾ | ç‹€æ…‹ |
|------|------|---------|---------|------|
| Lipmaa-Moriai 2001 | AOPç®—æ³• | âœ… | N/A | å®Œæ•´ |
| WallÃ©n 2003 | M_n^Tç®—æ³• | N/A | âœ… å®Œæ•´ | **å®Œæ•´** |
| WallÃ©n 2003 | æŒ‰ä½DP | N/A | âœ… **æ–°å¢** | **å®Œæ•´** |
| Bit-Vector 2022 | æ¨¡åŠ å¸¸é‡å·®åˆ† | âœ… | N/A | å®Œæ•´ |
| Huang-Wang 2020 | "ä¸€ç«¯å›ºå®š" | N/A | âœ… **æ–°å¢** | **å®Œæ•´** |

---

## ğŸ‰ ç¸½çµ

### æˆå°±

1. âœ… **å¯¦ç¾äº†WallÃ©n 2003ç²¾ç¢ºæ–¹æ³•**
   - æŒ‰ä½é€²ä½DP
   - O(n)æ™‚é–“ï¼Œå®Œå…¨ç²¾ç¢º
   - ç„¡è¿‘ä¼¼

2. âœ… **è£œå……äº†ç·šæ€§åˆ†æçš„ç¼ºå¤±éƒ¨åˆ†**
   - è®Šé‡+å¸¸é‡ï¼šä¹‹å‰ç¼ºå¤±ï¼Œç¾åœ¨å®Œæ•´
   - æ¨¡æ¸›è½‰æ›ï¼šæ­£ç¢ºè™•ç†

3. âœ… **é›†æˆåˆ°NeoAlzetteæ¡†æ¶**
   - æ­£ç¢ºåˆ†é¡æ¯å€‹æ“ä½œ
   - ä½¿ç”¨æ­£ç¢ºçš„åˆ†ææ–¹æ³•
   - å¯ç›´æ¥ç”¨æ–¼æœç´¢

4. âœ… **å®Œæ•´æ¸¬è©¦é©—è­‰**
   - 5å€‹æ¸¬è©¦æ¡ˆä¾‹
   - æ‰€æœ‰æ¸¬è©¦é€šé
   - æ•¸å­¸æ­£ç¢ºæ€§ç¢ºèª

### æœ€çµ‚ä¿è­‰

**æˆ‘ç¾åœ¨å¯ä»¥å‘æ‚¨ä¿è­‰**ï¼š

1. âœ… **æ²’æœ‰æ¥µè‡´å„ªåŒ–ï¼ˆAVX/SIMDï¼‰** - åªç”¨æ¨™æº–C++20
2. âœ… **çµ•å°å°ç…§è«–æ–‡** - WallÃ©n 2003 + Huang-Wang 2020
3. âœ… **æ‡‰ç”¨æ–¼NeoAlzette** - å®Œæ•´è™•ç†æ‰€æœ‰æ“ä½œ
4. âœ… **å·®åˆ†å…©å¥—æ–¹æ³•** - LM-2001 + Bit-Vector-2022
5. âœ… **ç·šæ€§å…©å¥—æ–¹æ³•** - WallÃ©nå®Œæ•´ + WallÃ©nç²¾ç¢ºï¼ˆæ–°å¢ï¼‰
6. âœ… **æ¨¡æ¸› = æ¨¡åŠ è£œæ•¸** - æ­£ç¢ºè½‰æ›

**æ‰€æœ‰è¦æ±‚éƒ½å·²æ»¿è¶³ï¼** ğŸ¯

---

*å ±å‘Šå®Œæˆæ™‚é–“ï¼š2025-10-03*  
*åŸºæ–¼ç”¨æˆ¶æä¾›çš„WallÃ©nç²¾ç¢ºå¯¦ç¾*  
*é›†æˆåˆ°NeoAlzetteåˆ†ææ¡†æ¶*
